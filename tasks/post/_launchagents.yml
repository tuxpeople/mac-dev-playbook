---
- name: "Check if {{ agent }} exists"
  ansible.builtin.stat:
    path: "{{ agent }}"
  register: launchagents_result

- name: "Unload {{ agent }}"
  ansible.builtin.command:
    cmd: "launchctl unload {{ agent }}"
  when: launchagents_result.stat.exists
  become: true
  changed_when: true
  failed_when: false