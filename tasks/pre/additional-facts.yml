# gathering additional facts
- name: Check if this is a MacBook
  block:
    # https://apple.stackexchange.com/a/98089
    - name: "Get model information"
      ansible.builtin.shell: "curl https://support-sp.apple.com/sp/product?cc=$(system_profiler SPHardwareDataType | awk '/Serial/ {print $4}' | cut -c 9-)"
      register: SPHardwareDataType
      changed_when: SPHardwareDataType.rc != 0

    - name: "Set fact macbook if appropriate"
      set_fact:
        macbook: true
      when: "'MacBook' in SPHardwareDataType.stdout"

- name: Check if this is a business or a private device
  block:
    - name: Set hostname
      set_fact:
        myhostname: "{{ newhostname | default(ansible_hostname) }}"

    - name: "Check if it is a business device"
      set_fact:
          myenv: "business_mac"
      when: myhostname is match("ws.*")

    - name: "Else it is a private device"
      set_fact:
        myenv: "private_mac"
      when: not myhostname is match("ws.*")

    - name: Group by purpose
      group_by: key=myenv
      changed_when: False

- name: Set homedir
  block:
    - name: Getting Users Homedir
      user:
        name: "{{ ansible_user }}"
        state: present
      register: this_user_registered

    - name: "Set fact myhomedir to {{ this_user_registered.home }}"
      set_fact:
        myhomedir: "{{ this_user_registered.home }}"

- name: "Set fact mybrewbindir to {{ (ansible_machine == 'arm64') | ternary('/opt/homebrew', '/usr/local') }}/bin"
  set_fact:
    mybrewbindir: "{{ (ansible_machine == 'arm64') | ternary('/opt/homebrew', '/usr/local') }}/bin"